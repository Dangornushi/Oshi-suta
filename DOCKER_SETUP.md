# Dockeré–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Dockerã¨Docker Composeã‚’ä½¿ç”¨ã—ã¦é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  docker-compose.yml                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     API      â”‚    â”‚    Redis     â”‚  â”‚
â”‚  â”‚  (FastAPI)   â”‚â”€â”€â”€â–¶â”‚   (Cache)    â”‚  â”‚
â”‚  â”‚  Port: 8000  â”‚    â”‚  Port: 6379  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                               â”‚
â”‚         â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   Firestore  â”‚                      â”‚
â”‚  â”‚  (Firebase)  â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. å‰ææ¡ä»¶ã®ç¢ºèª

ä»¥ä¸‹ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```bash
docker --version
docker-compose --version
```

### 2. Firebaseèªè¨¼æƒ…å ±ã®é…ç½®

Firebase Admin SDKã®èªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã€é…ç½®ï¼š

```bash
# backend/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®
cp /path/to/your/firebase-credentials.json backend/oshi-suta-battle-firebase-adminsdk-fbsvc-47d1d81ed5.json
```

### 3. ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã® `.env` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```bash
cat .env
```

å†…å®¹ï¼š
```env
FIREBASE_WEB_API_KEY=AIzaSyCrGjKDwfa_UJdUL3ucqSQ8Yd0k8os-flY
```

### 4. Docker Composeã§ãƒ“ãƒ«ãƒ‰ï¼†èµ·å‹•

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
docker-compose up --build
```

åˆå›ã¯æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

### 5. å‹•ä½œç¢ºèª

åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/api/v1/health

# æœŸå¾…ã•ã‚Œã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "status": "healthy",
  "timestamp": "2025-10-13T...",
  "version": "0.1.0",
  "services": {
    "firestore": "healthy",
    "redis": "healthy"
  }
}
```

## ğŸ”§ é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

### ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```bash
# ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ï¼ˆãƒ­ã‚°ã‚’è¡¨ç¤ºï¼‰
docker-compose up

# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•
docker-compose up -d
```

### ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢

```bash
# åœæ­¢
docker-compose down

# åœæ­¢ + ãƒœãƒªãƒ¥ãƒ¼ãƒ å‰Šé™¤ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚‚ã‚¯ãƒªã‚¢ï¼‰
docker-compose down -v
```

### ã‚³ãƒ³ãƒ†ãƒŠã®å†ãƒ“ãƒ«ãƒ‰

ã‚³ãƒ¼ãƒ‰ã‚„Dockerfileã‚’å¤‰æ›´ã—ãŸå ´åˆï¼š

```bash
docker-compose up --build
```

### ãƒ­ã‚°ã®ç¢ºèª

```bash
# å…¨ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°
docker-compose logs

# APIã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã®ã¿
docker-compose logs api

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ­ã‚°ã‚’è¿½è·¡
docker-compose logs -f api
```

### ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

```bash
# APIã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹
docker-compose exec api bash

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã§ãã‚‹ã“ã¨
python -m pytest          # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pip list                  # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç¢ºèª
uvicorn app.main:app      # ã‚µãƒ¼ãƒãƒ¼æ‰‹å‹•èµ·å‹•
```

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
Oshi-suta/
â”œâ”€â”€ .env                           # Docker Composeç”¨ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ docker-compose.yml             # Docker Composeè¨­å®š
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ .env                       # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªç”¨ç’°å¢ƒå¤‰æ•°
â”‚   â”œâ”€â”€ Dockerfile                 # APIã‚³ãƒ³ãƒ†ãƒŠã®ãƒ“ãƒ«ãƒ‰å®šç¾©
â”‚   â”œâ”€â”€ requirements.txt           # Pythonä¾å­˜é–¢ä¿‚
â”‚   â”œâ”€â”€ oshi-suta-battle-firebase-adminsdk-*.json  # Firebaseèªè¨¼æƒ…å ±
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ ...                    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰
â””â”€â”€ mobile_app/
    â””â”€â”€ ...                        # Flutterã‚¢ãƒ—ãƒª
```

## ğŸ”„ ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰

`docker-compose.yml`ã§ä»¥ä¸‹ã®è¨­å®šã«ã‚ˆã‚Šã€ã‚³ãƒ¼ãƒ‰å¤‰æ›´ãŒè‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã¾ã™ï¼š

```yaml
volumes:
  - ./backend:/app           # ãƒ­ãƒ¼ã‚«ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¦ãƒ³ãƒˆ
command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«ã‚µãƒ¼ãƒãƒ¼ãŒå†èµ·å‹•ã—ã¾ã™ã€‚

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒ¼ãƒˆãŒæ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹

```bash
# ã‚¨ãƒ©ãƒ¼ä¾‹
Error: bind: address already in use

# è§£æ±ºæ–¹æ³•ï¼šä½¿ç”¨ä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :8000
lsof -i :6379

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
kill -9 <PID>
```

### Firebaseèªè¨¼ã‚¨ãƒ©ãƒ¼

```bash
# ã‚¨ãƒ©ãƒ¼ä¾‹
Error: Could not load Firebase credentials

# è§£æ±ºæ–¹æ³•
1. backend/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«Firebaseèªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã‹ç¢ºèª
2. docker-compose.ymlã®FIREBASE_CREDENTIALS_PATHãŒæ­£ã—ã„ã‹ç¢ºèª
3. ã‚³ãƒ³ãƒ†ãƒŠã‚’å†ãƒ“ãƒ«ãƒ‰: docker-compose up --build
```

### Redisæ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# Redisã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèª
docker-compose ps redis

# Redisã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
docker-compose exec redis redis-cli ping
# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›: PONG
```

### ä¾å­˜é–¢ä¿‚ã®ã‚¨ãƒ©ãƒ¼

```bash
# requirements.txtã‚’æ›´æ–°ã—ãŸå ´åˆ
docker-compose build --no-cache api
docker-compose up
```

### ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```bash
# å…¨ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢ï¼†å‰Šé™¤
docker-compose down

# æœªä½¿ç”¨ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚‚å‰Šé™¤
docker system prune -a --volumes
```

## ğŸ“Š ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª

```bash
# å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠ
docker-compose ps

# ã‚³ãƒ³ãƒ†ãƒŠã®ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
docker stats

# ç‰¹å®šã®ã‚³ãƒ³ãƒ†ãƒŠã®è©³ç´°æƒ…å ±
docker-compose logs api
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker-compose exec api python -m pytest

# è©³ç´°ãªå‡ºåŠ›
docker-compose exec api python -m pytest -v

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
docker-compose exec api python -m pytest tests/test_auth.py
```

## ğŸ” ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

### .envãƒ•ã‚¡ã‚¤ãƒ«ã®å„ªå…ˆé †ä½

1. `docker-compose.yml`ã®`environment`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ€å„ªå…ˆï¼‰
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã®`.env`ï¼ˆDocker Composeç”¨ï¼‰
3. `backend/.env`ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰

### æœ¬ç•ªç’°å¢ƒç”¨è¨­å®š

æœ¬ç•ªç’°å¢ƒã§ã¯ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ãªãã€Docker Compose overrideã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã‚’ç›´æ¥æŒ‡å®šï¼š

```bash
# æœ¬ç•ªç’°å¢ƒç”¨ã®docker-compose.prod.yml
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
```

## ğŸ“ API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œã€ä»¥ä¸‹ã®URLã§APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªï¼š

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [README.md](README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- [PASSWORD_AUTH_SETUP.md](backend/PASSWORD_AUTH_SETUP.md) - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [AUTHENTICATION_GUIDE.md](mobile_app/AUTHENTICATION_GUIDE.md) - Flutterèªè¨¼å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ğŸ’¡ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã‚‰**: è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã®ã§å†èµ·å‹•ä¸è¦
2. **Dockerfileã‚’å¤‰æ›´ã—ãŸã‚‰**: `docker-compose up --build`
3. **requirements.txtã‚’å¤‰æ›´ã—ãŸã‚‰**: `docker-compose build --no-cache api`
4. **ç’°å¢ƒå¤‰æ•°ã‚’å¤‰æ›´ã—ãŸã‚‰**: `docker-compose down && docker-compose up`
5. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ãŸã‚‰**: `docker-compose down -v`